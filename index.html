<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My life — Surprise Book</title>
  <meta name="description" content="کتاب عاشقانه با افکت هک، جلد My life، ۶ صفحه با عکس‌ها و متن‌ها، موسیقی بی‌کلام و پایان قلب‌های بنفش." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg-dark:#05070b;--green:#00ff9c;--pink:#ff78c8;--pink2:#ff9bd4;--paper:#fff;--ink:#6d0c59;--ink2:#9a2e72;--ring:#e9b5dc;--purple:#8b5cf6;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:"Vazirmatn",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.9;background:var(--bg-dark);color:#fff;overflow-x:hidden}

    /* ========== HACK STAGE ========== */
    #stage-hack{position:fixed;inset:0;background:radial-gradient(900px 700px at 80% -120px,#0e1323 5%,#090d18 40%,#05070b 80%), #000;color:#a3ffd8;font-family:ui-monospace,Consolas,Menlo,monospace;display:flex;flex-direction:column}
    .hack-header{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;border-bottom:1px solid #0b1328;background:#050a14}
    .dot{width:8px;height:8px;border-radius:999px;background:var(--green);box-shadow:0 0 8px var(--green)}
    .hack-body{flex:1;padding:10px 12px;font-size:12px;overflow:auto}
    .line{opacity:.92;white-space:pre;}
    .hide{opacity:0;pointer-events:none}
    .fade{transition:opacity .9s ease}

    /* ========== BOOK STAGE (pink theme) ========== */
    #stage-love{position:relative;min-height:100dvh;padding:48px 16px;background:
      radial-gradient(1200px 800px at 20% -200px, #ffe2f2 0, #ffd1ea 25%, transparent 55%),
      radial-gradient(1200px 800px at 120% -200px, #ffe2f7 0, #ffd6ff 25%, transparent 55%),
      linear-gradient(180deg,#fff5fb, #ffe8f4 40%, #ffe1ff);color:var(--ink)}
    .container{width:min(980px,92%);margin-inline:auto}

    header.love{position:sticky;top:0;backdrop-filter:blur(10px);background:rgba(255,245,251,.6);border-bottom:1px solid rgba(138,43,226,.15);z-index:5}
    .nav{display:flex;justify-content:space-between;align-items:center;padding:10px 6px}
    .brand{display:flex;gap:10px;align-items:center;font-weight:800;color:var(--ink)}
    .logo{width:36px;height:36px;border-radius:12px;background:conic-gradient(from 0deg, #ff67bc, #ffb8e6, #c084fc, #ff67bc);display:grid;place-items:center;color:white;font-weight:900;box-shadow:0 10px 30px rgba(255,105,180,.35)}
    .cta{padding:8px 12px;border-radius:999px;background:#fff;border:1px solid rgba(138,43,226,.2);color:var(--ink);font-weight:800}

    .hero{text-align:center;margin:14px 0 10px}
    .hero h1{margin:0;font-size:clamp(26px,5.5vw,44px)}
    .hero p.sub{margin:6px 0 0;color:var(--ink2)}

    /* Cover book */
    .cover-wrap{display:grid;place-items:center;margin-top:18px}
    .cover{width:min(680px,95vw);height:400px;border-radius:18px;position:relative;cursor:pointer;transform-style:preserve-3d;perspective:2000px}
    .cover .board{position:absolute;inset:0;border-radius:18px;background:linear-gradient(135deg,#ffe5f4,#ffd3f1 40%,#f5ddff);border:2px solid var(--ring);box-shadow:0 20px 60px rgba(240,120,200,.35)}
    .cover .decor{position:absolute;inset:10px;border-radius:14px;border:1px dashed rgba(139,92,246,.45)}
    .cover h2{position:absolute;inset:auto 0 0 0;margin:0 auto 26px;text-align:center;width:100%;font-size:42px;letter-spacing:1px;color:var(--ink)}
    .ribbon{position:absolute;top:-10px;right:18px;background:#8b5cf6;color:#fff;padding:8px 12px;border-radius:10px;box-shadow:0 10px 30px rgba(139,92,246,.45)}
    .sparkles{position:absolute;left:18px;bottom:18px;font-size:24px;filter:drop-shadow(0 6px 12px rgba(255,105,180,.35))}

    /* Book pages (viewer) */
    .book{width:min(900px,96vw);height:500px;margin:22px auto 0;position:relative}
    .spread{position:absolute;inset:0;display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .page{background:var(--paper);border:1px solid rgba(139,92,246,.25);border-radius:14px;box-shadow:0 14px 36px rgba(240,120,200,.25);padding:14px;overflow:hidden;position:relative}
    .page h3{margin:0 0 6px;color:var(--ink)}
    .txt{color:var(--ink);white-space:pre-line}
    .ph{position:absolute;inset:0;display:grid;place-items:center;color:#c08;opacity:.3}
    .img{width:100%;height:100%;object-fit:cover;border-radius:10px}

    /* Flip effect between spreads */
    .flip-anim{position:absolute;inset:0;pointer-events:none}
    .sheet{position:absolute;top:0;bottom:0;right:0;width:50%;transform-origin:right center;background:var(--paper);border-left:1px solid rgba(139,92,246,.25);box-shadow:0 8px 26px rgba(0,0,0,.15);}
    .sheet.turn{animation:turn 0.9s ease forwards}
    @keyframes turn{0%{transform:rotateY(0)}100%{transform:rotateY(-180deg)}}

    .tip{margin:10px auto 0;display:flex;gap:10px;justify-content:center;color:var(--ink2);font-size:14px}
    .actions{margin-top:16px;display:flex;gap:12px;justify-content:center}
    .btn{padding:9px 14px;border-radius:12px;border:1px solid rgba(139,92,246,.25);background:#fff;color:var(--ink);font-weight:800}

    /* Finale */
    .finale{position:fixed;inset:0;display:none;place-items:center;background:linear-gradient(180deg,#fff5fb,#ffe8f4 40%,#ffe1ff)}
    .finale.show{display:grid;animation:fadein .6s ease}
    @keyframes fadein{from{opacity:0}to{opacity:1}}
    .finale h1{color:var(--ink);font-size:clamp(28px,7vw,60px);margin:0;text-align:center}

    /* Floating hearts */
    .heart{position:fixed;font-size:20px;pointer-events:none;animation:float 1.6s ease-out forwards;filter:drop-shadow(0 6px 12px rgba(139,92,246,.45))}
    @keyframes float{0%{opacity:0;transform:translate(-50%,10px) scale(.8)}12%{opacity:1}100%{opacity:0;transform:translate(-50%,-140px) scale(1.9)}}

    /* Small */
    @media (max-width:520px){.cover{height:340px}.book{height:440px}}
  </style>
</head>
<body>
  <!-- ===== Stage 1: Fake "Hack" Screen (≈4s) ===== -->
  <section id="stage-hack" class="fade">
    <div class="hack-header">
      <div style="display:flex;align-items:center;gap:8px"><span class="dot"></span><strong>secure-shell@morena-device</strong></div>
      <small>STATUS: LINKED • QR</small>
    </div>
    <div class="hack-body" id="hackBody"></div>
  </section>

  <!-- ===== Stage 2: Love / Book ===== -->
  <header class="love fade hide" id="loveHeader">
    <div class="container nav">
      <div class="brand"><span class="logo">💖</span> My life</div>
      <div style="display:flex;gap:8px;align-items:center">
        <a class="cta" id="shareBtn">نمایش QR لینک</a>
      </div>
    </div>
  </header>

  <main id="stage-love" class="fade hide">
    <div class="container">
      <section class="hero">
        <h1>Love you for ever my morena ✨</h1>
        <p class="sub">برای ورق زدن: فقط روی کتاب بزن 💗</p>
      </section>

      <!-- Closed cover -->
      <div class="cover-wrap" id="coverWrap">
        <div class="cover" id="cover">
          <div class="board"></div>
          <div class="decor"></div>
          <span class="ribbon">My life</span>
          <h2>My life</h2>
          <div class="sparkles">✨ 💜 ✨</div>
        </div>
        <div class="tip">بار اول کلیک → کتاب باز می‌شود</div>
      </div>

      <!-- Book viewer -->
      <div class="book hide" id="book">
        <div class="spread">
          <article class="page left" id="leftPage"></article>
          <article class="page right" id="rightPage"></article>
          <div class="flip-anim"><div class="sheet" id="sheet"></div></div>
        </div>
        <div class="tip">با هر کلیک، کتاب ورق می‌خورد (۳ بار). دفعهٔ چهارم: بسته می‌شود.</div>
        <div class="actions"><button class="btn" id="restart">شروع دوباره</button></div>
      </div>
    </div>
  </main>

  <!-- Finale overlay -->
  <div class="finale" id="finale"><h1>Forever Love 💜</h1></div>

  <!-- Minimal QR dialog -->
  <dialog id="qrDialog" style="border:none;border-radius:16px;padding:0;box-shadow:0 20px 80px rgba(0,0,0,.35)">
    <div style="padding:16px 16px 6px;background:#fff;border-top-left-radius:16px;border-top-right-radius:16px;color:var(--ink);font-weight:800">لینک این صفحه (QR)</div>
    <div id="qrBox" style="background:#fff;display:grid;place-items:center;padding:14px"></div>
    <form method="dialog" style="display:flex;gap:10px;justify-content:flex-end;background:#fff;border-bottom-left-radius:16px;border-bottom-right-radius:16px;padding:8px 12px">
      <button class="btn" style="margin:6px 0">بستن</button>
    </form>
  </dialog>

  <script>
    /* ===== Simple ambient music with WebAudio (no external file) ===== */
    let audioStarted = false;
    function startMusic(){
      if(audioStarted) return; audioStarted = true;
      const AC = window.AudioContext || window.webkitAudioContext; const ctx = new AC(); 
      const master = ctx.createGain(); master.gain.value = 0.06; master.connect(ctx.destination);
      function tone(freq, t0, dur){
        const o = ctx.createOscillator(); const g = ctx.createGain();
        o.type = 'sine'; o.frequency.value = freq; g.gain.value = 0; o.connect(g); g.connect(master);
        const now = ctx.currentTime; o.start(now+t0);
        g.gain.linearRampToValueAtTime(0.0001, now+t0);
        g.gain.linearRampToValueAtTime(0.22, now+t0+0.05);
        g.gain.linearRampToValueAtTime(0.0001, now+t0+dur);
        o.stop(now+t0+dur+0.05);
      }
      // Simple romantic arpeggio in A major
      const seq = [440,554.37,659.25,880,659.25,554.37,493.88,659.25];
      for(let i=0;i<64;i++){
        const f = seq[i%seq.length]; tone(f/2, i*0.8, 0.7);
      }
    }

    // ===== Hack stage =====
    const hackBody = document.getElementById('hackBody');
    const hackLines = [
      '[link] establishing QR handshake... ok',
      'scanning device: morena-device — secure channel...',
      'decrypt: aes-256-gcm — session key ok',
      'mount /love — rw — ok',
      'stream >>>'
    ];
    function randHex(len){ const s='0123456789abcdef'; let out=''; for(let i=0;i<len;i++) out+=s[(Math.random()*s.length)|0]; return out; }
    function pushLine(txt){ const div=document.createElement('div'); div.className='line'; div.textContent=txt; hackBody.appendChild(div); hackBody.scrollTop=hackBody.scrollHeight; }
    hackLines.forEach((l,i)=> setTimeout(()=>pushLine(l), 120*i));
    const spam = setInterval(()=>{ pushLine(randHex(48)+'  '+randHex(32)); }, 40);

    setTimeout(()=>{
      clearInterval(spam);
      document.getElementById('stage-hack').classList.add('hide');
      document.getElementById('stage-love').classList.remove('hide');
      document.getElementById('loveHeader').classList.remove('hide');
    }, 4000); // ≈4s

    // ===== Book logic =====
    const coverWrap = document.getElementById('coverWrap');
    const cover = document.getElementById('cover');
    const book = document.getElementById('book');
    const leftPage = document.getElementById('leftPage');
    const rightPage = document.getElementById('rightPage');
    const sheet = document.getElementById('sheet');
    const finale = document.getElementById('finale');

    // IMAGES: put your real hosted paths here (same folder recommended)
    const imgs = {
      p1: 'img/page1.jpg', // زوج با نور بنفش
      p3: 'img/page3.jpg', // بچگی با لباس سفید
      p4: 'img/page4.jpg', // سلفی لبخند
      p5: 'img/page5.jpg', // عکس آینه
    };

    // Content for spreads (1..3)
    const spreads = [
      { // spread 1: pages 1 (right) & 2 (left)
        right: (el)=>{
          el.innerHTML = `<img class="img" src="${imgs.p1}" alt="page1"><div class="txt" style="position:absolute;inset:auto 10px 10px 10px;background:rgba(255,255,255,.8);border-radius:10px;padding:8px 10px;text-align:center">💜این شب هیچوقت از یاد من نمیره</div>`;
        },
        left: (el)=>{
          el.innerHTML = `<div class="txt" style="padding:16px;font-size:18px;line-height:2">بابت همه چی معذرت میخوام\nو قول میدم از اینجا به بعد همه چیو درست کنم\nهمه زندگی من 💜</div>`;
        }
      },
      { // spread 2: pages 3 & 4
        right: (el)=>{
          el.innerHTML = `<img class="img" src="${imgs.p3}" alt="page3"><div class="txt" style="position:absolute;inset:auto 10px 10px 10px;background:rgba(255,255,255,.85);border-radius:10px;padding:8px 10px;text-align:center">الان که بزرگ شدی تا توی این لباس\n💜 نبینمت نمیمیرم و میمونم کنارت و اینو تنت میکنم</div>`;
        },
        left: (el)=>{
          el.innerHTML = `<img class="img" src="${imgs.p4}" alt="page4"><div class="txt" style="position:absolute;inset:auto 10px 10px 10px;background:rgba(255,255,255,.85);border-radius:10px;padding:8px 10px;text-align:center">💜همین خنده های قشنگت دلیل همه شادیای منه</div>`;
        }
      },
      { // spread 3: pages 5 & 6
        right: (el)=>{ el.innerHTML = `<img class=\"img\" src=\"${imgs.p5}\" alt=\"page5\">`; },
        left: (el)=>{
          el.innerHTML = `<div class="txt" style="padding:16px;font-size:18px;line-height:2">ببخشید که خیلی روزای بدیو باهام داشتی\nولی اینو مطمئن باش\nکه قراره همه چی عوض شه\nتنها چیزی که حداقل الان ازت\nمیخوام اینه که منو دوست داشته باشی فقط\nمن بی نهایت دوست دارم\nکاملا درک میکنم که چه\nاتفاقای بدی افتاده ولی قول میدم همشو جبران کنم برات\nنفس و زندگی من\n\n💜 دوست داره تو سوبر</div>`;
        }
      }
    ];

    let step = 0; // 0: cover, 1..3 spreads, 4: close

    function setSpread(idx){
      spreads[idx-1].left(leftPage);
      spreads[idx-1].right(rightPage);
    }

    function flip(){
      sheet.classList.remove('turn'); void sheet.offsetWidth; sheet.classList.add('turn');
    }

    function openBook(){
      coverWrap.classList.add('hide');
      book.classList.remove('hide');
      setSpread(1); step = 1; flip();
      startMusic();
    }

    function next(){
      if(step>=1 && step<=2){ // go to next spread
        flip();
        setTimeout(()=>{ setSpread(step+1); }, 450);
        step++;
      }else if(step===3){ // close
        flip();
        setTimeout(()=>{
          book.classList.add('hide');
          coverWrap.classList.remove('hide');
          step = 0;
          showFinale();
        }, 500);
      }
    }

    function showFinale(){
      finale.classList.add('show');
      for(let i=0;i<48;i++){
        setTimeout(()=>spawnHeart(window.innerWidth*Math.random(), window.innerHeight-10), i*90);
      }
      setTimeout(()=>finale.classList.remove('show'), 4000);
    }

    // Hearts on any tap (after hack stage)
    function spawnHeart(x,y){ const s=document.createElement('span'); s.className='heart'; s.textContent='💜'; s.style.left=x+'px'; s.style.top=y+'px'; document.body.appendChild(s); setTimeout(()=>s.remove(),1600); }
    document.addEventListener('click',(e)=>{ if(document.getElementById('stage-love').classList.contains('hide')) return; spawnHeart(e.clientX, e.clientY); });

    cover.addEventListener('click',()=>{ startMusic(); openBook(); });
    book.addEventListener('click',()=>{ next(); });
    document.getElementById('restart').addEventListener('click',()=>{ finale.classList.remove('show'); coverWrap.classList.remove('hide'); book.classList.add('hide'); step=0;});

    // ===== QR maker (Google Chart API) =====
    const shareBtn = document.getElementById('shareBtn');
    const qrDialog = document.getElementById('qrDialog');
    const qrBox = document.getElementById('qrBox');
    shareBtn.addEventListener('click', ()=>{
      const url = location.href; // online لینک نهایی
      const api = `https://chart.googleapis.com/chart?cht=qr&chs=300x300&chl=${encodeURIComponent(url)}`;
      qrBox.innerHTML=''; const img=new Image(); img.width=300; img.height=300; img.alt='QR'; img.src=api; qrBox.appendChild(img);
      const small=document.createElement('div'); small.style.cssText='font-size:12px;color:#6d0c59;margin-top:8px;text-align:center;word-break:break-all'; small.textContent=url; qrBox.appendChild(small);
      qrDialog.showModal();
    });
  </script>
</body>
</html>
